{% extends "base.html" %}
{% block title %}New Item - QR Food Storage{% endblock %}

{% block content %}
<h2>New Food Item</h2>

{% if errors is defined and errors %}
<article style="background:var(--pico-del-color);color:#fff;padding:0.75rem 1rem">
    <ul style="margin:0;padding-left:1.2rem">
        {% for e in errors %}<li>{{ e }}</li>{% endfor %}
    </ul>
</article>
{% endif %}

<form method="post" action="/items" enctype="multipart/form-data">
    <label>
        Food item name *
        <input type="text" name="name" required value="{{ form.name if form is defined and form.name else '' }}">
    </label>

    <div class="grid">
        <label>
            Date prepared *
            <input type="date" name="date_prepared" required value="{{ form.date_prepared if form is defined and form.date_prepared else today }}">
        </label>
        <label>
            Expiration date
            <input type="date" name="expiration_date" value="{{ form.expiration_date if form is defined and form.expiration_date else default_exp }}">
        </label>
    </div>

    <label>
        Storage location *
        <select name="storage_location_id" required>
            {% for loc in locations %}
            <option value="{{ loc.id }}" {% if form is defined and form.storage_location_id == loc.id %}selected{% elif preselect_location is defined and preselect_location == loc.id %}selected{% endif %}>{{ loc.name }}</option>
            {% endfor %}
        </select>
    </label>
    <small><a href="/locations">Manage locations</a></small>

    <div class="grid">
        <label>
            Amount (optional)
            <input type="number" name="amount" step="any" min="0" placeholder="e.g. 2, 1.5" value="{{ form.amount if form is defined and form.amount else '' }}">
        </label>
        <label>
            Unit
            <select name="amount_unit">
                <option value="">--</option>
                {% for u in ["qty", "cups", "oz", "lbs", "grams", "liters", "ml"] %}
                <option value="{{ u }}" {% if form is defined and form.amount_unit == u %}selected{% endif %}>{{ u }}</option>
                {% endfor %}
            </select>
        </label>
    </div>

    <label>
        Notes (optional)
        <textarea name="notes" rows="2" placeholder="e.g. half batch, extra spicy...">{{ form.notes if form is defined and form.notes else '' }}</textarea>
    </label>

    <label>
        Photo (optional)
        <input type="file" name="photo" accept="image/*">
    </label>

    <fieldset>
        <legend>Links (optional)</legend>
        <div id="links-container">
            <div class="link-row">
                <input type="url" name="link_urls" placeholder="https://..." class="link-url">
                <input type="text" name="link_labels" placeholder="Label (optional)" class="link-label">
            </div>
        </div>
        <button type="button" class="outline secondary" onclick="addLink()" style="margin-top:0.5rem">+ Add another link</button>
    </fieldset>

    <button type="submit">Create Item & Generate Label</button>
</form>

<script>
function addLink() {
    const container = document.getElementById('links-container');
    const row = document.createElement('div');
    row.className = 'link-row';
    row.innerHTML = '<input type="url" name="link_urls" placeholder="https://..." class="link-url">'
        + '<input type="text" name="link_labels" placeholder="Label (optional)" class="link-label">'
        + '<button type="button" class="outline secondary" onclick="this.parentElement.remove()" style="margin-bottom:0">âœ•</button>';
    container.appendChild(row);
}
</script>
{% endblock %}
