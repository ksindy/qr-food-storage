{% extends "base.html" %}
{% block title %}Items - QR Food Storage{% endblock %}

{% block content %}
<h2>Food Items</h2>

<form class="filters" method="get" action="/">
    <input type="search" name="q" value="{{ q }}" placeholder="Search by name..." style="max-width:250px">
    <select name="location" style="max-width:180px">
        <option value="">All locations</option>
        {% for loc in locations %}
        <option value="{{ loc.id }}" {% if selected_location == loc.id %}selected{% endif %}>{{ loc.name }}</option>
        {% endfor %}
    </select>
    <label style="display:flex;align-items:center;gap:0.3rem;margin-bottom:0;white-space:nowrap">
        <input type="checkbox" name="show_deleted" value="true" {% if show_deleted %}checked{% endif %} role="switch" style="margin-bottom:0">
        Show deleted
    </label>
    <button type="submit" class="outline" style="margin-bottom:0">Filter</button>
</form>

{% if revisions %}
    {% for rev in revisions %}
    <a href="/i/{{ rev.item.public_id }}" style="text-decoration:none;color:inherit">
        <article class="item-card {% if rev.is_deleted %}deleted{% endif %}">
            <div style="display:flex;gap:1rem;align-items:start">
                {% if rev.photo_filename %}
                <img src="{{ photo_url(rev.photo_filename) }}" alt="" class="photo-thumb">
                {% endif %}
                <div style="flex:1">
                    <h3>{{ rev.name }}</h3>
                    <div class="item-meta">
                        <span class="badge badge-location" data-location="{{ rev.storage_location.name|lower }}">{{ rev.storage_location.name }}</span>
                        {% if rev.is_deleted %}
                            <span class="badge badge-deleted">Deleted</span>
                        {% endif %}
                        {% if rev.expiration_date and rev.expiration_date < today and not rev.is_deleted %}
                            <span class="badge badge-expired">Expired</span>
                        {% endif %}
                        {% if rev.expiration_date %}
                         &nbsp; Expires: {{ rev.expiration_date.strftime('%b %d, %Y') }}
                        {% endif %}
                    </div>
                    {% if rev.notes %}
                    <p class="item-notes"><span class="note-icon"></span>{{ rev.notes.split('\n')[0] }}</p>
                    {% endif %}
                </div>
            </div>
        </article>
    </a>
    {% endfor %}
{% else %}
    <p>No items found. <a href="/items/new">Create one</a>.</p>
{% endif %}
{% endblock %}
